---
title: 'STA 380, Part 2: Exercises'
author: "Aditya Soni, Brandt Green, Bret Jaco"
date: "8/10/2021"
output: pdf_document
---
#Association Rule Mining
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(arules)
```

## Reading the data
```{r}
groceries = read.transactions("groceries.txt", format = "basket", sep = ",",
                              rm.duplicates = FALSE)
```
## Exploring transactions and items

Structure of data = 9835 transactions and 169 items

###
```{r}
summary(groceries)
```
Top 10 most ordered items
```{r}
itemFrequencyPlot(groceries, topN = 10)
```
10 Least Ordered Items
*Least ordered item = Baby food (support = 0.0001)
```{r}
barplot(sort(itemFrequency(groceries), decreasing=FALSE)[0:10])
```

##Building a Model 

Since we have a lot of items, let's select a minimum support of 0.01. However, as we can see, keeping a support of 0.01 will remove almost half of the items. (Since the support works on pair-wise criteria, the exact exclusions will be different but we can still get a sense of the support value)
```{r}
summary(itemFrequency(groceries)>0.01)
```

Thus, we try with a support of 0.001:

```{r}
summary(itemFrequency(groceries)>0.001)

```

Here, we see that we are removing only the twelve least-ordered items from the analysis, which is acceptable.

##Apriori model
Using a support of 0.001 and confidence of 0.50, i.e. the conditional probability of A given B should be at least 50%. We chose confidence=0.50 as there are so many items and orders, so its better to start with a value somewhere in the middle.
Result= We get 5668 rules- 11 rules with 2 items, 1461 rules with 3 items, 3211 rules with 4 items, 939 rules with 5 items and 46 rules with 6 items.
```{r}
basket_model1 = apriori(groceries, parameter = list(support = 0.001, confidence = 0.50, target='rules'))
summary(basket_model1)
```
##Looking at some specific rules
Here we see the top 10 associations sorted by maximum lift. We see that all these rules have a very low support, just above the threshold of 0.001. Also, there are some rules which have a length of 4/5/6. Thus, to refine our model we can increase the support threshold and decrease the maximum length of rules to 3. 
```{r}
inspect(sort(basket_model1, by = 'lift')[1:10])
```

##Refined Model
Change support to 0.003, maxlength to 4.
Result = A set of 414 rules- 5 rules with 2 items, 281 rules with 3 items, 128 rules with 4 items.
```{r}
basket_model2 = apriori(groceries, parameter = list(support = 0.003, confidence = 0.50, target='rules', maxlen = 4))
summary(basket_model2)
```

##Analysis
(Sorted by highest lift)
The rules make sense as they are products which are related and bought often very often. 
```{r}
inspect(sort(basket_model2, by = 'lift')[1:10])
```

##To get a dataframe of rules:
```{r}
df = as(basket_model2, "data.frame")
df[1:10,]
```

Thus, we successfully completed an association analysis on the grocery dataset to recommend new products to consumers based on the products in their carts. 
